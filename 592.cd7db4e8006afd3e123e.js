"use strict";(self.webpackChunkfirst_project_webpack_ts=self.webpackChunkfirst_project_webpack_ts||[]).push([[592],{6535:function(e,s,a){a.r(s),a.d(s,{default:function(){return oe}});var t=a(5443),r=a(7294),i=a(9250),n=a(2882),d=a(3007),c=a(9864),l=a(1492),o=a(1326),m=a(526);const x=a(6628).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e,_expand:"user"}})})})}).useGetArticleRecommendationsListQuery;var j=a(7499),u=a(8969),g=a(5893);const h=(0,r.memo)((e=>{const{className:s}=e,{t:a}=(0,t.$)(),{isLoading:r,data:i,error:c}=x(3);return r||c||!i?null:(0,g.jsxs)(o.g,{gap:"8",className:(0,d.A)("",{},[s]),children:[(0,g.jsx)(j.zJ,{feature:"isAppRedesigned",on:(0,g.jsx)(u.x,{size:"l",title:a("Рекомендуем")}),off:(0,g.jsx)(m.xv,{size:m.yH.L,title:a("Рекомендуем")})}),(0,g.jsx)(n.wD,{articles:i})]})}));var p=a(743);const f=(0,r.lazy)((()=>a.e(933).then(a.bind(a,1933))));var v=a(9085),N=a(6265),A=a(8281),w=a(1066),C={CommentCard:"xIHByGcu",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"},b=a(776),y=a(5146),L=a(6621),z=a(7231),k=a(9244);const I=(0,r.memo)((e=>{const{className:s,comment:a,isLoading:t}=e,r=(0,j.tn)({name:"isAppRedesigned",on:()=>A.O,off:()=>N.O});return t?(0,g.jsx)(j.zJ,{feature:"isAppRedesigned",on:(0,g.jsxs)(o.g,{gap:"8",max:!0,className:(0,d.A)(C.CommentCard,{},[s,C.loading]),children:[(0,g.jsxs)("div",{className:C.header,children:[(0,g.jsx)(r,{width:30,height:30,border:"50%"}),(0,g.jsx)(r,{width:16,height:16,className:C.username})]}),(0,g.jsx)(r,{className:C.text,width:"100%",height:50})]}),off:(0,g.jsxs)(o.g,{gap:"8",max:!0,className:(0,d.A)(C.CommentCard,{},[s,C.loading]),children:[(0,g.jsxs)("div",{className:C.header,children:[(0,g.jsx)(r,{width:30,height:30,border:"50%"}),(0,g.jsx)(r,{width:16,height:16,className:C.username})]}),(0,g.jsx)(r,{className:C.text,width:"100%",height:50})]})}):a?(0,g.jsx)(j.zJ,{feature:"isAppRedesigned",on:(0,g.jsx)(z.Z,{padding:"24",border:"lightly",max:!0,children:(0,g.jsxs)(o.g,{gap:"8",max:!0,className:(0,d.A)(C.CommentCardRedesigned,{},[s]),children:[(0,g.jsx)(y.F,{to:(0,b.CJ)(a.user.id),children:(0,g.jsxs)(k.U,{children:[a.user.avatar?(0,g.jsx)(L.q,{size:30,src:a.user.avatar}):null,(0,g.jsx)(u.x,{text:a.user.username,bold:!0})]})}),(0,g.jsx)(u.x,{text:a.text})]})}),off:(0,g.jsxs)(o.g,{gap:"8",max:!0,className:(0,d.A)(C.CommentCard,{},[s]),children:[(0,g.jsxs)(w.F,{to:(0,b.CJ)(a.user.id),className:C.header,children:[a.user.avatar?(0,g.jsx)(v.q,{size:30,src:a.user.avatar}):null,(0,g.jsx)(m.xv,{className:C.username,title:a.user.username})]}),(0,g.jsx)(m.xv,{className:C.text,text:a.text})]})}):null})),R=(0,r.memo)((e=>{const{className:s,comments:a,isLoading:r}=e,{t:i}=(0,t.$)();return r?(0,g.jsxs)(o.g,{gap:"16",max:!0,className:(0,d.A)("",{},[s]),children:[(0,g.jsx)(I,{isLoading:!0}),(0,g.jsx)(I,{isLoading:!0}),(0,g.jsx)(I,{isLoading:!0})]}):(0,g.jsx)(o.g,{gap:"16",max:!0,className:(0,d.A)("",{},[s]),children:a?.length?a.map((e=>(0,g.jsx)(I,{isLoading:r,comment:e},e.id))):(0,g.jsx)(j.zJ,{feature:"isAppRedesigned",on:(0,g.jsx)(u.x,{text:i("Нет комментариев")}),off:(0,g.jsx)(m.xv,{text:i("Нет комментариев")})})})}));var S=a(5401),D=a(9970),_=a(7953),q=a(4268);const U=(0,q.hg)("articleDetails/fetchCommentsByArticleId",(async(e,s)=>{const{extra:a,rejectWithValue:t}=s;if(!e)return t("error");try{const s=await a.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!s.data)throw new Error;return s.data}catch(e){return t("error")}})),E=(0,q.HF)({selectId:e=>e.id}),J=E.getSelectors((e=>e.articleDetailsPage?.comments||E.getInitialState())),O=(0,q.oM)({name:"articleDetailsCommentsSlice",initialState:E.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(U.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(U.fulfilled,((e,s)=>{e.isLoading=!1,E.setAll(e,s.payload)})).addCase(U.rejected,((e,s)=>{e.isLoading=!1,e.error=s.payload}))}}),{reducer:P}=O,$=e=>e.articleDetailsPage?.comments?.isLoading;var H=a(8029);const Z=(0,q.hg)("articleDetails/addCommentForArticle",(async(e,s)=>{const{extra:a,dispatch:t,rejectWithValue:r,getState:i}=s,d=(0,H.m5)(i()),c=(0,n.wq)(i());if(!d||!e||!c)return r("no data");try{const s=await a.api.post("/comments",{articleId:c.id,userId:d.id,text:e});if(!s.data)throw new Error;return t(U(c.id)),s.data}catch(e){return r("error")}})),F=(0,r.memo)((e=>{const{className:s,id:a}=e,{t:i}=(0,t.$)(),n=(0,S.T)(),c=(0,p.v9)(J.selectAll),l=(0,p.v9)($),x=(0,r.useCallback)((e=>{n(Z(e))}),[n]);return(0,D.Q)((()=>{n(U(a))})),(0,g.jsxs)(o.g,{gap:"16",max:!0,className:(0,d.A)("",{},[s]),children:[(0,g.jsx)(j.zJ,{feature:"isAppRedesigned",on:(0,g.jsx)(u.x,{size:"l",title:i("Комментарии")}),off:(0,g.jsx)(m.xv,{size:m.yH.L,title:i("Комментарии")})}),(0,g.jsx)(r.Suspense,{fallback:(0,g.jsx)(_.a,{}),children:(0,g.jsx)(f,{onSendComment:x})}),(0,g.jsx)(R,{isLoading:l,comments:c})]})}));var T="adu8fSDx",V=a(5173);const W=(0,q.hg)("articleDetailsPage/fetchArticleRecommendations",(async(e,s)=>{const{extra:a,rejectWithValue:t}=s;try{const e=await a.api.get("/articles",{params:{_limit:4}});if(!e.data)throw new Error;return e.data}catch(e){return t("error")}})),M=(0,q.HF)({selectId:e=>e.id}),B=(M.getSelectors((e=>e.articleDetailsPage?.recommendations||M.getInitialState())),(0,q.oM)({name:"articleDetailsPageRecommendationsSlice",initialState:M.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(W.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(W.fulfilled,((e,s)=>{e.isLoading=!1,M.setAll(e,s.payload)})).addCase(W.rejected,((e,s)=>{e.isLoading=!1,e.error=s.payload}))}})),{reducer:G}=B,K=(0,V.UY)({recommendations:G,comments:P});var Q=a(7702);const X=(0,a(2222).P1)(n.wq,H.m5,((e,s)=>!(!e||!s)&&e.user.id===s.id)),Y=(0,r.memo)((e=>{const{className:s}=e,{t:a}=(0,t.$)(),c=(0,i.s0)(),l=(0,p.v9)(X),m=(0,p.v9)(n.wq),x=(0,r.useCallback)((()=>{c((0,b.k7)())}),[c]),j=(0,r.useCallback)((()=>{m&&c((0,b.mK)(m?.id))}),[m,c]);return(0,g.jsxs)(o.U,{max:!0,justify:"between",className:(0,d.A)("",{},[s]),children:[(0,g.jsx)(Q.zx,{theme:Q.bn.OUTLINE,onClick:x,children:a("Назад к списку")}),l&&(0,g.jsx)(Q.zx,{theme:Q.bn.OUTLINE,onClick:j,children:a("Редактировать")})]})})),ee=(0,r.lazy)((()=>a.e(272).then(a.bind(a,9272)))),se=e=>(0,g.jsx)(r.Suspense,{fallback:(0,g.jsx)(A.O,{width:"100%",height:130}),children:(0,g.jsx)(ee,{...e})});var ae=a(7647),te=a(5290);const re=(0,r.memo)((e=>{const{className:s}=e,{t:a}=(0,t.$)(),{id:r}=(0,i.UO)();return(0,g.jsx)(z.Z,{max:!0,border:"lightly",className:s,padding:"24",children:(0,g.jsx)(n.D0,{id:r})})}));var ie=a(8190);const ne=(0,r.memo)((e=>{const{className:s,author:a,createdAt:r,views:i,onEdit:n}=e,{t:c}=(0,t.$)();return(0,g.jsxs)(k.g,{gap:"32",className:(0,d.A)("",{},[s]),children:[(0,g.jsxs)(k.U,{gap:"8",children:[(0,g.jsx)(L.q,{src:a.avatar,size:32}),(0,g.jsx)(u.x,{text:a.username,bold:!0}),(0,g.jsx)(u.x,{text:r})]}),(0,g.jsx)(ie.z,{onClick:n,children:c("Редактировать")}),(0,g.jsx)(u.x,{text:c("{{count}} просмотров",{count:i})})]})}));const de=(0,r.memo)((()=>{const e=(0,p.v9)(n.wq),s=(0,i.s0)(),a=(0,r.useCallback)((()=>{e&&s((0,b.mK)(e.id))}),[e,s]);return e?(0,g.jsx)(z.Z,{padding:"24",border:"lightly",className:"VfnX1ntZ",children:(0,g.jsx)(ne,{onEdit:a,views:e.views,createdAt:e.createdAt,author:e.user})}):null})),ce={articleDetailsPage:K},le=e=>{const{className:s}=e,{t:a}=(0,t.$)("article-details"),{id:r}=(0,i.UO)();return r?(0,g.jsx)(c.W,{reducers:ce,removeAfterUnmount:!0,children:(0,g.jsx)(j.zJ,{feature:"isAppRedesigned",on:(0,g.jsx)(te.w,{content:(0,g.jsx)(l.T,{className:(0,d.A)(T,{},[s]),children:(0,g.jsxs)(o.g,{gap:"16",max:!0,children:[(0,g.jsx)(re,{}),(0,g.jsx)(se,{articleId:r}),(0,g.jsx)(h,{}),(0,g.jsx)(F,{id:r})]})}),right:(0,g.jsx)(de,{})}),off:(0,g.jsx)(l.T,{className:(0,d.A)(T,{},[s]),children:(0,g.jsxs)(o.g,{gap:"16",max:!0,children:[(0,g.jsx)(Y,{}),(0,g.jsx)(n.D0,{id:r}),(0,g.jsx)(j.zJ,{feature:"isArticleRatingEnabled",on:(0,g.jsx)(se,{articleId:r}),off:(0,g.jsx)(ae.Z,{children:a("Оценка статей скоро появится!")})}),(0,g.jsx)(h,{}),(0,g.jsx)(F,{id:r})]})})})}):null};var oe=(0,r.memo)(le)}}]);